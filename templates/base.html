<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="/static/css/nullable.css">
    <link rel="stylesheet" href="/static/css/style.css">
    {% block head %}
    <title>Blog App</title>
    {% endblock %}
</head>
<body>
    <nav class="nav">
    <h1 class="nav-title"><a href="http://127.0.0.1:8000/">Blog App</a></h1>
    <ul class="nav-links">
        <li class="nav-link"><a href="/">Home</a></li>
        
        {% if user.is_authenticated %}
            <li class="nav-link"><a href="/logout">Logout</a></li>
            <li class="nav-link"><a href="http://127.0.0.1:8000/entries">Create blog</a></li>
            <li class="nav-link"><a href="{% url 'profile' username=user.username %}">Profile</a></li>
        {% else %}
            <li class="nav-link"><a href="/login">Log in</a></li>
            <li class="nav-link"><a href="/registration">Sign in</a></li>
        
        {% endif %}
    </ul>
</nav>


    {% if messages %}
        <ul class="messages">
            {% for message in messages %}
            <li
                {% if message.tags %}
                class="{{ message.tags }}"
                {% endif %}>
                <p> {{message}} </p>
                <button class="message-close-btn" onclick="closeMessage(this)">
                    <svg class="progress-ring" width="50" height="50">
                        <circle
                            class="progress-ring-circle"
                            stroke="darkred"
                            stroke-width="3"
                            fill="transparent"
                            r="20"
                            cx="23"
                            cy="25"></circle>
                    </svg>
                    <svg class="message-close-btn-cross" width="20" height="20" viewBox="0 0 32 32" xmlns="http://www.w3.org/2000/svg">
                        <path d="M24 8 L8 24 M8 8 L24 24" stroke="#000" stroke-width="3" stroke-linecap="round"/>
                    </svg>
                </button>
            </li>
            {% endfor %}
        </ul>
        {% endif %}

    <script>
        function closeMessage(btn) {
            let message = btn.closest("li");
            message.remove();
        }

        document.addEventListener('DOMContentLoaded', function () {
            const messages = document.querySelectorAll(".messages li");

            messages.forEach((message) => {
                const circle = message.querySelector('.progress-ring-circle');
                const timeout = 15000;

                if (!circle) return;

                // Таймер на видалення повідомлення
                const removeTimer = setTimeout(() => {
                    message.remove();
                }, timeout);

                // Початок анімації кола
                const radius = circle.r.baseVal.value;
                const circumference = 2 * Math.PI * radius;

                circle.style.strokeDasharray = `${circumference} ${circumference}`;
                circle.style.strokeDashoffset = 0;

                let start = null;
                function animateCircle(time) {
                    if (!start) start = time;
                    const elapsed = time - start;
                    const progress = elapsed / timeout;

                    if (progress < 1) {
                        const offset = circumference * progress;
                        circle.style.strokeDashoffset = offset;
                        requestAnimationFrame(animateCircle);
                    } else {
                        circle.style.strokeDashoffset = circumference;
                    }
                }

                requestAnimationFrame(animateCircle);
            });
        });
    </script>
    

    {% block content %}
    {% endblock %}
</body>
</html>
